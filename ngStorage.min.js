!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["angular"],b):a.hasOwnProperty("angular")?b(a.angular):"object"==typeof exports&&(module.exports=b(require("angular")))}(this,function(a){"use strict";function b(b){return function(){var c="ngStorage-";this.setKeyPrefix=function(a){if("string"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setKeyPrefix() expects a String.");c=a};var d=a.toJson,e=a.fromJson,f=!1;if(chrome)try{chrome.storage.local.set({ngStorageTestVal:"it is working"}),f=!0}catch(a){}this.setSerializer=function(a){if("function"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setSerializer expects a function.");d=a},this.setDeserializer=function(a){if("function"!=typeof a)throw new TypeError("[ngStorage] - "+b+"Provider.setDeserializer expects a function.");e=a},this.get=function(a){return f?void chrome.storage.local.get(c+a,function(a){return e(a)}):e(window[b].getItem(c+a))},this.set=function(a,e){if(f){var g={};return g[c+a]=d(e),chrome.storage.local.set(g)}return window[b].setItem(c+a,d(e))},this.$get=["$rootScope","$window","$log","$timeout","$document",function(g,h,i,j,k){function l(a){var b;try{b=h[a]}catch(a){b=!1}if(b&&"localStorage"===a){var c="__"+Math.round(1e7*Math.random());try{localStorage.setItem(c,c),localStorage.removeItem(c)}catch(a){b=!1}}return f&&(b=!0,console.log("switching to chrome storage")),b}var p,q,m=c.length,n=l(b)||(i.warn("This browser does not support Web Storage!"),{setItem:a.noop,getItem:a.noop,removeItem:a.noop}),o={$default:function(b){for(var c in b)a.isDefined(o[c])||(o[c]=a.copy(b[c]));return o.$sync(),o},$reset:function(a){for(var b in o)if(f){var d={};d[c+b]=null,"$"===b[0]||delete o[b]&&chrome.storage.local.set(d)}else"$"===b[0]||delete o[b]&&n.removeItem(c+b);return o.$default(a)},$sync:function(){for(var d,a=0,b=n.length;a<b;a++)if(f){var g;chrome.storage.local.get(d,function(b){g=b,(d=n.key(a))&&c===d.slice(0,m)&&(o[d.slice(m)]=e(g))})}else(d=n.key(a))&&c===d.slice(0,m)&&(o[d.slice(m)]=e(n.getItem(d)))},$apply:function(){var b;if(q=null,!a.equals(o,p)){b=a.copy(p),a.forEach(o,function(e,g){if(a.isDefined(e)&&"$"!==g[0]){if(f){var h={};h[c+g]=d(e),chrome.storage.local.set(h)}else n.setItem(c+g,d(e));delete b[g]}});for(var e in b)if(f){var g={};g[c+e]=null,chrome.storage.local.set(g)}else n.removeItem(c+e);p=a.copy(o)}}};return o.$sync(),p=a.copy(o),g.$watch(function(){q||(q=j(o.$apply,100,!1))}),h.addEventListener&&h.addEventListener("storage",function(b){if(b.key){var d=k[0];d.hasFocus&&d.hasFocus()||c!==b.key.slice(0,m)||(b.newValue?o[b.key.slice(m)]=e(b.newValue):delete o[b.key.slice(m)],p=a.copy(o),g.$apply())}}),h.addEventListener&&h.addEventListener("beforeunload",function(){o.$apply()}),o}]}}return a=a&&a.module?a:window.angular,a.module("ngStorage",[]).provider("$localStorage",b("localStorage")).provider("$sessionStorage",b("sessionStorage"))});